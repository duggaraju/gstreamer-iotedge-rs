<html>
  <head>
    <script type="text/javascript" src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
    <script type="text/javascript">
      var html5VideoElement;
      var websocketConnection;
      var webrtcPeerConnection;
      var webrtcConfiguration;
      var reportError;


      function onLocalDescription(desc) {
        console.log("Local description: " + JSON.stringify(desc));
        webrtcPeerConnection.setLocalDescription(desc).then(function() {
          websocketConnection.send(JSON.stringify({ sdp: webrtcPeerConnection.localDescription }));
        }).catch(reportError);
      }


      function onIncomingSDP(sdp) {
        console.log("Incoming SDP: " + JSON.stringify(sdp));
        webrtcPeerConnection.setRemoteDescription(sdp).catch(reportError);
        webrtcPeerConnection.createAnswer().then(onLocalDescription).catch(reportError);
      }


      function onIncomingICE(ice) {
        var candidate = new RTCIceCandidate(ice);
        console.log("Incoming ICE: " + JSON.stringify(ice));
        webrtcPeerConnection.addIceCandidate(candidate).catch(reportError);
      }


      function onAddRemoteStream(event) {
        html5VideoElement.srcObject = event.streams[0];
        //html5VideoElement.play();
      }


      function onIceCandidate(event) {
        if (event.candidate == null)
          return;

        console.log("Sending ICE candidate out: " + JSON.stringify(event.candidate));
        websocketConnection.send(JSON.stringify({ ice: event.candidate }));
      }


      function onServerMessage(event) {
        var msg;

        try {
          msg = JSON.parse(event.data);
        } catch (e) {
          return;
        }

        if (!webrtcPeerConnection) {
          webrtcPeerConnection = new RTCPeerConnection(webrtcConfiguration);
          webrtcPeerConnection.ontrack = onAddRemoteStream;
          webrtcPeerConnection.onicecandidate = onIceCandidate;
        }

        if (msg.sdp != undefined) {
          onIncomingSDP(msg.sdp);
        } else if (msg.ice != undefined) {
          onIncomingICE(msg.ice);
        } else {
          switch (msg.type) {
            case "sdp": onIncomingSDP(msg.data); break;
            case "ice": onIncomingICE(msg.data); break;
            default: break;
          }
        }
      }


      function playStream(videoElement, hostname, port, path, configuration, reportErrorCB) {
        var l = window.location;
        var wsHost = (hostname != undefined) ? hostname : l.hostname;
        var wsPort = (port != undefined) ? port : l.port;
        var wsPath = (path != undefined) ? path : "ws";
        if (wsPort)
          wsPort = ":" + wsPort;
        var wsUrl = "ws://" + wsHost + wsPort + "/" + wsPath;

        html5VideoElement = videoElement;
        webrtcConfiguration = configuration;
        reportError = (reportErrorCB != undefined) ? reportErrorCB : function(text) {};

        websocketConnection = new WebSocket(wsUrl);
        websocketConnection.addEventListener("message", onServerMessage);
      }

      function setClock()
      {
        const now = new Date();
        const format = now.toLocaleTimeString('en-US', {
          hour:"2-digit",
          minute:"2-digit",
          second:"2-digit",
          hour12: false,
          fractionalSecondDigits:2
          
        })
        document.getElementById('clock').innerText = format;
      }

      window.onload = function() {
        var vidstream = document.getElementById("stream");
        var config = { 'iceServers': [{ 'urls': 'stun:stun.l.google.com:19302' }] };
        setInterval(setClock, 100);
        playStream(vidstream, null, null, null, config, function (errmsg) { console.error(errmsg); });
      };

    </script>
  </head>

  <body>
    <h2 id="clock"></h2>
    <div>
      <video id="stream" autoplay muted controls playsinline>Your browser does not support video</video>
    </div>
  </body>
</html>